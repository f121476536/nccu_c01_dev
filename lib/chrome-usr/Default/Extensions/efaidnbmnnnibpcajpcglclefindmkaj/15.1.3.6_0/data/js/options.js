/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
const OptionPageActions={OPTIONS_UPDATE_TOGGLE:"OPTIONS_UPDATE_TOGGLE"};$((function(){"use strict";const t=acom_analytics.e,e="analyticsOptinTitle",s="web2pdfOptOut",n="LearnMoreURL",i="web2pdfPrivacy",a="web2pdfShowPDFTools",r="web2pdfFrictionlessToggleDescription",o="pdfOwnershipExploreOptionsTitle",l="pdfOwnershipExploreOptionsDescription",c="web2pdfOpenConvertedPDFTitle",d="web2pdfOpenConvertedPDFDescription",p="web2pdfShowPersistentOpen",h="web2pdfShowPersistentOpenDescription",u="optionsSuccessPrompt",S="optionsFailurePrompt";let I=[],E={},T=null;class f{constructor(){this.ID="#web2pdfSaveButton",this.closePromptID="#prompt-close",this.enableState=!1,this.optionStates=new Set,this.timeoutId=null,$(this.ID).click(t=>this.SavePreferences(t)),$(this.closePromptID).click(t=>this.HideSavedPrompt(t))}Reset(){this.enableState=!1,this.optionStates.clear(),$(this.ID).prop("disabled",!0)}setEnabled(t){this.optionStates.add(t),$(this.ID).prop("disabled",!1),this.enableState=!0}setDisabled(t){this.optionStates.has(t)&&(this.optionStates.delete(t),0===this.optionStates.size&&($(this.ID).prop("disabled",!0),this.enableState=!1))}GetState(){return this.enableState}SavePreferences(){const t={analytics:[]};for(const e in E)E[e].hasUpdated&&(t[e]=E[e].GetCurrentState());I.filter(t=>t.hasUpdated).map(t=>t.SavePreferences()).filter(t=>t).forEach(e=>t.analytics.push(e)),function(t,e){util.messageToMain({main_op:"save-preferences",...t},e)}(t,t=>{t.success?this.ShowSavedPrompt(!0):this.ShowSavedPrompt(!1),this.Reset(),R(t=>{D(t.settings),m(t),b()})})}ShowSavedPrompt(t){const e=$("#savePrompt"),s=$(".prompt"),n=$("#optionsSuccessPrompt");t?(n.text(util.getTranslation(u)),s.removeClass("failure")):(n.text(util.getTranslation(S)),s.addClass("failure")),e.show(),this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(t=>this.HideSavedPrompt(),5e3)}HideSavedPrompt(){$("#savePrompt").hide()}}class g{constructor(t,e,s,n){this.titleId=t,this.descriptionId=e,this.defaultState=util.getCookie(this.storageKey)||s,this.storageKey=n,this.currentState=this.defaultState,this.hasUpdated=!1,this.savePreferencesButton=null}AttachEventHandler(t){this.savePreferencesButton=t}RenderInputItem(){return $("<div/>")}Render(){const t=$("<div/>",{class:"option"}),e=$("<label/>",{class:"label",for:this.titleId}),s=$("<span/>",{class:"label-title",text:util.getTranslation(this.titleId)||this.titleId,id:this.titleId}),n=$("<span/>",{class:"label-description",text:util.getTranslation(this.descriptionId)||this.descriptionId,id:this.descriptionId});e.append(s),e.append(n),t.append(e);const i=this.RenderInputItem();return t.append(i),t}GetCurrentState(){return this.currentState}SavePreferences(){this.hasUpdated&&(this.storageKey&&(console.log("Updating Preference for ",this.storageKey,"from",util.getCookie(this.storageKey,this.defaultState),"to",this.currentState),util.setCookie(this.storageKey,this.currentState)),this.hasUpdated=!1,this.defaultState=this.currentState)}}class _ extends g{constructor(t,e,s,n,i,a){super(t,e,s,n),this.defaultState=function(t,e=!1){const s=util.getCookie(t);return s&&""!==s?"true"===s:e}(this.storageKey,s),this.currentState=this.defaultState,this.analyticsId={enabled:i,disabled:a}}onToggleChange(t){const e=$(t.currentTarget);this.currentState=!e.hasClass("checked"),this.hasUpdated=!this.hasUpdated,e.toggleClass("checked"),this.savePreferencesButton&&this.currentState===this.defaultState?this.savePreferencesButton.setDisabled(this.titleId):this.savePreferencesButton.setEnabled(this.titleId)}RenderInputItem(){const t=$("<span/>"),e=$("<button/>",{class:"option-toggle"});return e.click(t=>this.onToggleChange(t)),this.currentState&&e.addClass("checked"),t.append(e),t}GetAnalytics(){return this.currentState?this.analyticsId.enabled:this.analyticsId.disabled}SavePreferences(){return super.SavePreferences(),this.GetAnalytics()}}class v extends g{constructor(t,e,s,n){super(t,e,n,null),this.valuesMap=s}onSelectionChange(t){this.currentState=$(t.currentTarget).val(),this.currentState===this.defaultState?(this.hasUpdated=!1,this.savePreferencesButton&&this.savePreferencesButton.setDisabled(this.titleId)):(this.hasUpdated=!0,this.savePreferencesButton&&this.savePreferencesButton.setEnabled(this.titleId))}RenderInputItem(){const t=$("<span/>"),e=$("<select/>",{class:"option-select"});for(const t in this.valuesMap){const s=$("<option/>",{value:t,text:this.valuesMap[t]});e.append(s)}return e.change(t=>this.onSelectionChange(t)),this.currentState&&e.val(this.currentState),t.append(e),t}}class O extends _{constructor(){super(e,s,!0,"logAnalytics",t.OPTIONS_ENABLED_ANALYTICS,t.OPTIONS_DISABLED_ANALYTICS),this.learnMoreLink=n,this.learnMoreTitle=i}Render(){const t=$("<div/>",{class:"option"}),e=$("<label/>",{class:"label",for:this.titleId}),s=$("<span/>",{class:"label-title",text:util.getTranslation(this.titleId),id:this.titleId}),n=$("<span/>",{class:"label-description",text:util.getTranslation(this.descriptionId)+" ",id:this.descriptionId}),i=$("<a/>",{class:"learn-more",href:util.getTranslation(this.learnMoreLink),text:util.getTranslation(this.learnMoreTitle),target:"_blank"});n.append(i),e.append(s),e.append(n),t.append(e);const a=this.RenderInputItem();return t.append(a),t}SavePreferences(){if(this.hasUpdated)return this.hasUpdated=!1,this.defaultState=this.currentState,this.GetAnalytics()}}function P(t){return t.version>13}function N(t){return 13==t.version}function A(){const t=util.getCookie("fteDenied")||"0",e="false"===util.getCookie("pdfViewer");return SETTINGS.USE_ACROBAT&&SETTINGS.VIEWER_SHOW_OPEN_IN_ACRO&&(10===parseInt(t)||e)}function D(t){if(t&&t.settings){for(const e in t.settings)SETTINGS[e]=t.settings[e];(function(t){return null===t.locale})(t)&&(SETTINGS.FRICTIONLESS_ENABLED=!1)}}function b(){null==T&&(T=new f);const t=$("#toggles");t.empty(),I.forEach(e=>{e.AttachEventHandler(T);const s=e.Render();t.append(s)})}function m(e){I=[],E={};const s=new O,n=new _(a,r,!0,"always-show-pdftools",t.FRICTIONLESS_AUTO_SUGGESTION_ENABLED,t.FRICTIONLESS_AUTO_SUGGESTION_DISABLED),i=new _(o,l,!1,"pdfViewer",t.USE_ACROBAT_IN_CHROME_ENABLED,t.USE_ACROBAT_IN_CHROME_DISABLED),u=new _(c,d,!0,"ViewResultsPref",t.TREFOIL_HTML_OPENPDF_PREF_ON,t.TREFOIL_HTML_OPENPDF_PREF_OFF),S=new _(p,h,!0,"always-show-pdf-menu",t.OPTIONS_ENABLED_OPEN_IN_ACROBAT,t.OPTIONS_DISABLED_OPEN_IN_ACROBAT);P(e)?(I.push(u),SETTINGS.VIEWER_ENABLED&&SETTINGS.VIEWER_ENABLED_FOR_ACROBAT?(I.push(i),A()&&I.push(S)):I.push(S)):N(e)?SETTINGS.VIEWER_ENABLED?(I.push(i),SETTINGS.FRICTIONLESS_ENABLED&&!util.isEdge()&&I.push(n),A()&&I.push(S)):(SETTINGS.FRICTIONLESS_ENABLED&&!util.isEdge()&&I.push(n),I.push(S)):(SETTINGS.VIEWER_ENABLED&&I.push(i),SETTINGS.FRICTIONLESS_ENABLED&&!util.isEdge()&&I.push(n)),I.push(s),E.analytics_on=s,function(t){if(SETTINGS.USE_ACROBAT&&SETTINGS.DEBUG_MODE){const e=new v("Development Environment","Select the target environment for the extension.",{prod:"Production",stage:"Stage",test:"Test",dev:"Dev","local-dev":"Local Dev"},t.environment||"prod"),s=P(t)?"acrobat":N(t)?"reader":"no-app",n=new v("Connected Application","Select the target connected application for the extension functionalities. This settings only mock the views, the functionality may be broken.",{acrobat:"Acrobat",reader:"Reader","no-app":"No App"},s||"acrobat");I.push(e,n),E.environment=e,E.product=n}}(e)}function R(t){util.messageToMain({main_op:"fetch-preferences"},t)}function C(t){const e=I.filter(e=>e.titleId===t);return e.length>0?e[0]:null}function L(t,e,s){const n=t.toggleId,i=C(n),a=t.requestType;let r=void 0,o=void 0;switch(a){case OptionPageActions.OPTIONS_UPDATE_TOGGLE:{const e="true"===t.toggleVal;i?(i.currentState=e,i.hasUpdated=!0,i.savePreferencesButton.SavePreferences(),r=i.currentState):o="Toggle not visible."}}s({requestType:a,toggleId:n,response:r,error:o})}$(document).ready((function(){util.translateElements(".translate"),R(t=>{D(t),m(t),b(),util.addMainListener(L),function(){if(!SETTINGS.TEST_MODE)return;const t="check_toggle_state",e="update_toggle_state";chrome.runtime.onMessage.addListener((function(s,n,i){if(!s.panel_op||"test"!==s.panel_op)return;const a=s.test_extension,r=s.toggleId,o=C(r);let l=void 0,c=void 0;switch(a){case t:o?l=o.currentState:c="Toggle not visible.";break;case e:const n="true"===s.toggleVal;o?(o.currentState=n,o.hasUpdated=!0,o.savePreferencesButton.SavePreferences(),l=o.currentState):c="Toggle not visible.";break;default:c="Invalid request type."}i({requestType:a,toggleId:r,response:l,error:c})}))}()})}))}));